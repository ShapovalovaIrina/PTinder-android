# This workflow will build a Java project with Gradle
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-gradle

name: Java CI with Gradle

on: push

jobs:
  integration_test:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8

      - name: Install docker
        run: |
          brew install --cask docker
          docker run hello-world
          docker â€“-version
      - name: Init swarm
        run: docker swarm init
      - name: Deploy swarm
        run: docker stack deploy -c docker/docker-compose.yml app
      - name: Sleep for 40 seconds
        uses: jakejarvis/wait-action@master
        with:
          time: '40s'
      - name: Docker ps
        run: docker stack ps app

      - name: run tests
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: 29
          arch: x86_64
          disable-animations: true
          profile: Nexus 5X
          emulator-options: -no-window -no-boot-anim -no-audio
          script: ./gradlew connectedAndroidCheck
